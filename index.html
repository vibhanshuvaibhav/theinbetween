<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The In-Between | Kinetic Void</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            margin: 0; padding: 0;
            background-color: #050505; /* Minimalist dark */
            color: #ffffff;
            font-family: 'Inter', -apple-system, sans-serif;
            overflow: hidden;
            display: flex; flex-direction: column; align-items: center;
            transition: background 2s ease;
        }

        #ui-layer {
            position: absolute; top: 15%; z-index: 10;
            text-align: center; width: 100%; pointer-events: none;
        }

        input {
            background: transparent; border: none;
            border-bottom: 1px solid #222;
            color: #fff; font-size: 1.2rem; text-align: center;
            outline: none; width: 280px; padding: 10px;
            pointer-events: auto; transition: all 0.8s ease;
            font-weight: 200; letter-spacing: 1px;
        }

        input:focus { border-bottom: 1px solid #eee; width: 350px; }

        #instruction {
            color: #444; font-size: 0.7rem; margin-top: 15px;
            letter-spacing: 3px; text-transform: uppercase;
        }

        #void-glow {
            position: absolute; bottom: -100px;
            width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, rgba(0,0,0,0) 70%);
            border-radius: 50%; z-index: 1; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <input type="text" id="thoughtInput" placeholder="Type a thought..." autocomplete="off">
        <div id="instruction">Press Enter to drop it</div>
    </div>

    <div id="void-glow"></div>

    <script>
        // 1. AUDIO ENGINE (Brown Noise for focus)
        let audioStarted = false;
        const noise = new Tone.Noise("brown").start();
        const filter = new Tone.AutoFilter({ frequency: "8n", baseFrequency: 200, octaves: 2 }).connect(Tone.Destination);
        noise.connect(filter);
        noise.volume.value = -Infinity;

        async function initAudio() {
            if (!audioStarted) {
                await Tone.start();
                noise.volume.rampTo(-25, 5); // Smooth fade in
                filter.start();
                audioStarted = true;
            }
        }

        function playPop() {
            const synth = new Tone.MetalSynth({
                harmonicity: 12, resonance: 800,
                modulationIndex: 20, envelope: { attack: 0.01, decay: 0.4 }
            }).toDestination();
            synth.triggerAttackRelease("C6", "16n", undefined, 0.1);
        }

        // 2. PHYSICS ENGINE (Matter.js)
        const { Engine, Render, Runner, Bodies, Composite, Mouse, MouseConstraint, Events } = Matter;
        const engine = Engine.create();
        engine.gravity.y = 0.1; // Soft gravity

        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: window.innerWidth,
                height: window.innerHeight,
                wireframes: false,
                background: 'transparent'
            }
        });

        // Floor (invisible)
        const ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight + 50, window.innerWidth, 100, { isStatic: true });
        Composite.add(engine.world, [ground]);

        // 3. INPUT INTERACTION
        const input = document.getElementById('thoughtInput');
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && input.value.trim() !== "") {
                initAudio();
                const text = input.value;
                const bubble = Bodies.circle(window.innerWidth/2, 150, 30 + text.length * 2, {
                    restitution: 0.6, friction: 0.1,
                    render: { fillStyle: 'transparent', strokeStyle: '#333', lineWidth: 1 }
                });
                bubble.thoughtText = text;
                bubble.label = "thought";
                Composite.add(engine.world, bubble);
                input.value = "";
            }
        });

        // Mouse interaction (dragging bubbles)
        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse, constraint: { stiffness: 0.2, render: { visible: false } }
        });
        Composite.add(engine.world, mouseConstraint);

        // Render text inside bubbles
        Events.on(render, 'afterRender', () => {
            const context = render.context;
            context.font = "300 14px Inter";
            context.fillStyle = "rgba(255, 255, 255, 0.6)";
            context.textAlign = "center";
            Composite.allBodies(engine.world).forEach(body => {
                if (body.thoughtText) {
                    context.fillText(body.thoughtText, body.position.x, body.position.y + 5);
                }
            });
        });

        // 4. THE VOID LOGIC
        Events.on(engine, 'beforeUpdate', () => {
            const voidX = window.innerWidth / 2;
            const voidY = window.innerHeight;

            Composite.allBodies(engine.world).forEach(body => {
                if (body.label === "thought") {
                    const dist = Math.hypot(body.position.x - voidX, body.position.y - voidY);
                    
                    if (dist < 250) { // Sucking effect
                        body.force.x = (voidX - body.position.x) * 0.001;
                        body.force.y = (voidY - body.position.y) * 0.001;
                        
                        if (dist < 40) { // Disappear
                            playPop();
                            Composite.remove(engine.world, body);
                        }
                    }
                }
            });
        });

        Render.run(render);
        Runner.run(Runner.create(), engine);

        window.addEventListener('resize', () => {
            render.canvas.width = window.innerWidth;
            render.canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
