<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The In-Between</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.js"></script>
    <style>
        * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: none; outline: none; }
        body { margin: 0; padding: 0; background: #050505; overflow: hidden; cursor: crosshair; }
        
        #gate {
            position: fixed; inset: 0; background: #050505; z-index: 2000;
            display: flex; align-items: center; justify-content: center;
            color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            letter-spacing: 4px; font-weight: 200; font-size: 0.75rem; text-transform: lowercase;
        }

        #instruction-overlay {
            position: absolute; top: 15%; width: 100%; text-align: center; color: #ffffff;
            font-family: -apple-system, sans-serif; font-weight: 300; font-size: 0.85rem; 
            line-height: 2.2; letter-spacing: 1px; z-index: 200; pointer-events: none; 
            opacity: 0; transition: opacity 1.5s; text-transform: lowercase;
        }

        #stats-bar {
            position: absolute; top: 40px; width: 100%; display: flex; 
            justify-content: center; gap: 30px; color: #ffffff; 
            font-family: sans-serif; font-weight: 300; font-size: 0.75rem; 
            letter-spacing: 1px; pointer-events: none; text-transform: lowercase;
        }

        #quit-btn {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            color: #ffffff; font-family: sans-serif; font-size: 0.7rem; 
            letter-spacing: 2px; border: 1px solid #ffffff; padding: 10px 20px; 
            border-radius: 25px; cursor: pointer; z-index: 300; text-transform: lowercase;
        }

        #end-screen {
            position: fixed; inset: 0; background: #050505; display: none; 
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 3000; text-align: center; color: #ffffff; font-family: sans-serif;
        }

        .bubble {
            position: absolute; background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 0.5px solid rgba(255, 255, 255, 0.4);
            padding: 6px 14px; border-radius: 20px; color: #ffffff;
            font-size: 12px; pointer-events: none; display: none; z-index: 100;
        }
    </style>
</head>
<body>

    <div id="gate" onclick="start()">[ tap to enter flow state ]</div>

    <audio id="snd" loop playsinline preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2513/2513-preview.mp3" type="audio/mpeg">
    </audio>

    <div id="instruction-overlay">
        follow the gold; it is your purpose<br>
        embrace the gifts found in the rhythm<br>
        protect the red; it's your peace<br>
        target 100s of flow state
    </div>

    <div id="stats-bar">
        <span id="f-count">flow: 0s</span>
        <span id="p-count">üç∞: 0</span>
        <span id="d-count">üíé: 0</span>
    </div>

    <div id="quit-btn" onclick="finish()">end session</div>

    <div id="end-screen">
        <p id="sum-txt" style="line-height: 2; margin-bottom: 30px; font-weight: 200;"></p>
        <button onclick="location.reload()" style="background:none; border:1px solid #fff; color:#fff; padding: 10px 20px; border-radius: 20px;">return</button>
    </div>

    <div id="g-msg" class="bubble">follow me</div>
    <div id="w-msg" class="bubble" style="background: rgba(200, 0, 0, 0.5);">whoa...</div>

    <script>
        let gold, white, red, items = [];
        let frames = 0, pEaten = 0, dEaten = 0, active = false, angle = 0;
        const Y_OFF = -100;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            gold = createVector(width/2, height*0.3);
            white = createVector(width/2, height/2);
            red = createVector(width/2, height*0.7);
        }

        function start() {
            active = true;
            document.getElementById('gate').style.display = 'none';
            document.getElementById('instruction-overlay').style.opacity = '1';
            let a = document.getElementById('snd');
            a.volume = 0.4;
            a.play().catch(()=>{});
            setTimeout(() => { document.getElementById('instruction-overlay').style.opacity = '0'; }, 4000);
        }

        function draw() {
            background(5, 5, 5, 90);
            if (!active) return;

            angle += 0.007;
            let targetG = createVector(width/2 + cos(angle*0.8)*(width*0.35), height/2 + sin(angle*0.6)*(height*0.25));
            let magG = p5.Vector.lerp(targetG, white, 0.15);
            gold.lerp(magG, 0.08);

            if (mouseIsPressed || (touches && touches.length > 0)) {
                white.lerp(createVector(mouseX, mouseY + Y_OFF), 0.15);
            }
            red.lerp(white, 0.04);

            if (frameCount % 120 === 0) {
                items.push({pos: createVector(random(50, width-50), random(100, height-100)), t: random()>0.4?'p':'d', l: 400});
            }

            for (let i = items.length-1; i >= 0; i--) {
                if (dist(white.x, white.y, items[i].pos.x, items[i].pos.y) < 40) {
                    if (items[i].t === 'p') pEaten++; else dEaten++;
                    items.splice(i, 1);
                    if (navigator.vibrate) navigator.vibrate(15);
                } else if (--items[i].l <= 0) items.splice(i, 1);
            }

            let d = dist(white.x, white.y, gold.x, gold.y);
            render(d);
        }

        function render(d) {
            document.getElementById('f-count').innerText = `flow: ${Math.floor(frames/60)}s`;
            document.getElementById('p-count').innerText = `üç∞: ${pEaten}`;
            document.getElementById('d-count').innerText = `üíé: ${dEaten}`;

            if (d > 200) {
                red.x += random(-3, 3); red.y += random(-3, 3);
                pop('g-msg', gold.x, gold.y - 40);
                pop('w-msg', red.x, red.y + 40);
            } else {
                frames++;
                document.getElementById('g-msg').style.display = 'none';
                document.getElementById('w-msg').style.display = 'none';
            }

            textSize(20); textAlign(CENTER, CENTER);
            items.forEach(i => text(i.t==='p'?'üç∞':'üíé', i.pos.x, i.pos.y));
            
            strokeWeight(1.5);
            stroke(255, d > 200 ? 50 : 20);
            line(gold.x, gold.y, white.x, white.y);
            line(white.x, white.y, red.x, red.y);

            noStroke();
            fill(212, 175, 55); ellipse(gold.x, gold.y, 30);
            fill(200, 50, 50); ellipse(red.x, red.y, 22);
            fill(255); ellipse(white.x, white.y, 16);
            fill(255, 30); ellipse(white.x, white.y, 40);
        }

        function pop(id, x, y) {
            let e = document.getElementById(id);
            e.style.display = 'block'; e.style.left = x+'px'; e.style.top = y+'px';
        }

        function finish() {
            document.getElementById('snd').pause();
            document.getElementById('end-screen').style.display = 'flex';
            document.getElementById('sum-txt').innerText = `you stayed in the flow for ${Math.floor(frames/60)}s.\n\nyou gathered ${pEaten} moments of sweetness\nand ${dEaten} moments of clarity.\n\nyour have reclaimed your focus.\nreturn to work now.`;
        }

        function windowResized() { resizeCanvas(windowWidth, windowHeight); }
    </script>
</body>
</html>
