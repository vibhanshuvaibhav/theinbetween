<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The In-Between</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.js"></script>
    <style>
        * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: none; outline: none; }
        body { margin: 0; padding: 0; background: #050505; overflow: hidden; cursor: crosshair; }
        
        #gate {
            position: fixed; inset: 0; background: #050505; z-index: 2000;
            display: flex; align-items: center; justify-content: center;
        }

        .btn-ui {
            background: none; border: 1px solid #ffffff; color: #ffffff; 
            padding: 12px 30px; border-radius: 30px; cursor: pointer;
            font-family: sans-serif; font-weight: 200; font-size: 0.75rem; 
            letter-spacing: 3px; text-transform: lowercase; transition: all 0.6s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .btn-ui:active { background: #ffffff; color: #000000; }

        #instruction-overlay {
            position: absolute; top: 18%; width: 100%; text-align: center; color: #ffffff;
            font-family: -apple-system, sans-serif; font-weight: 300; font-size: 0.85rem; 
            line-height: 2.8; letter-spacing: 1px; z-index: 200; pointer-events: none; 
            opacity: 0; transition: opacity 2s ease-in-out; text-transform: lowercase;
        }

        #stats-bar {
            position: absolute; top: 40px; width: 100%; display: flex; 
            justify-content: center; gap: 30px; color: #ffffff; 
            font-family: sans-serif; font-weight: 300; font-size: 0.7rem; 
            letter-spacing: 1px; pointer-events: none; text-transform: lowercase; opacity: 0.6;
        }

        #quit-btn {
            position: absolute; bottom: 45px; left: 50%; transform: translateX(-50%);
            z-index: 300;
        }

        #end-screen {
            position: fixed; inset: 0; background: #050505; display: none; 
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 3000; text-align: center; color: #ffffff; font-family: sans-serif;
        }

        .bubble {
            position: absolute; background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 0.5px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px; border-radius: 20px; color: #ffffff;
            font-size: 11px; pointer-events: none; opacity: 0; z-index: 100;
            transition: opacity 0.8s ease-in-out;
        }
    </style>
</head>
<body>

    <div id="gate">
        <button class="btn-ui" onclick="start()">enter flow state</button>
    </div>

    <audio id="snd" loop playsinline preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2523/2523-preview.mp3" type="audio/mpeg">
    </audio>

    <div id="instruction-overlay">
        follow the gold; it is your purpose<br>
        embrace the gifts found in the rhythm<br>
        protect the red; it's your peace<br>
        target 100s to enter flow state
    </div>

    <div id="stats-bar">
        <span id="f-count">flow: 0s</span>
        <span id="p-count">üç∞: 0</span>
        <span id="d-count">üíé: 0</span>
    </div>

    <button id="quit-btn" class="btn-ui" style="display:none;" onclick="finish()">end session</button>

    <div id="end-screen">
        <p id="sum-txt" style="line-height: 2.2; margin-bottom: 45px; font-weight: 200; white-space: pre-line; font-size: 0.9rem;"></p>
        <button class="btn-ui" onclick="location.reload()">return</button>
    </div>

    <div id="g-msg" class="bubble">follow me</div>
    <div id="w-msg" class="bubble" style="background: rgba(255, 255, 255, 0.05);">whoa...</div>

    <script>
        let gold, white, red, items = [];
        let frames = 0, pEaten = 0, dEaten = 0, active = false, angle = 0;
        const Y_OFF = -120;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            gold = createVector(width/2, height*0.3);
            white = createVector(width/2, height/2);
            red = createVector(width/2, height*0.7);
        }

        function start() {
            active = true;
            document.getElementById('gate').style.display = 'none';
            document.getElementById('quit-btn').style.display = 'block';
            
            let inst = document.getElementById('instruction-overlay');
            inst.style.opacity = '1';
            
            let a = document.getElementById('snd');
            a.volume = 0.25; 
            a.play().catch(()=>{});
            
            setTimeout(() => { inst.style.opacity = '0'; }, 5500);
        }

        function draw() {
            background(5, 5, 5, 110);
            if (!active) return;

            angle += 0.007;
            let targetG = createVector(width/2 + cos(angle*0.8)*(width*0.32), height/2 + sin(angle*0.6)*(height*0.22));
            let springG = p5.Vector.lerp(targetG, white, 0.12);
            gold.lerp(springG, 0.085);

            if (mouseIsPressed || (touches && touches.length > 0)) {
                white.lerp(createVector(mouseX, mouseY + Y_OFF), 0.15);
            }
            red.lerp(white, 0.04);

            if (frameCount % 145 === 0) {
                items.push({pos: createVector(random(60, width-60), random(140, height-140)), t: random()>0.4?'p':'d', l: 550});
            }

            for (let i = items.length-1; i >= 0; i--) {
                if (dist(white.x, white.y, items[i].pos.x, items[i].pos.y) < 45) {
                    if (items[i].t === 'p') pEaten++; else dEaten++;
                    items.splice(i, 1);
                    if (navigator.vibrate) navigator.vibrate(6); 
                } else if (--items[i].l <= 0) items.splice(i, 1);
            }

            let d = dist(white.x, white.y, gold.x, gold.y);
            render(d);
        }

        function render(d) {
            document.getElementById('f-count').innerText = `flow: ${Math.floor(frames/60)}s`;
            document.getElementById('p-count').innerText = `üç∞: ${pEaten}`;
            document.getElementById('d-count').innerText = `üíé: ${dEaten}`;

            if (d > 215) {
                red.x += random(-1.5, 1.5); red.y += random(-1.5, 1.5); 
                pop('g-msg', gold.x, gold.y - 50, true);
                pop('w-msg', red.x, red.y + 45, true);
            } else {
                frames++;
                pop('g-msg', 0, 0, false);
                pop('w-msg', 0, 0, false);
            }

            textSize(22); textAlign(CENTER, CENTER);
            items.forEach(i => text(i.t==='p'?'üç∞':'üíé', i.pos.x, i.pos.y));
            
            strokeWeight(1.2);
            stroke(255, d > 215 ? 45 : 18);
            line(gold.x, gold.y, white.x, white.y);
            line(white.x, white.y, red.x, red.y);

            noStroke();
            fill(212, 175, 55); ellipse(gold.x, gold.y, 30);
            fill(200, 50, 50); ellipse(red.x, red.y, 22);
            fill(255); ellipse(white.x, white.y, 16);
            fill(255, 25); ellipse(white.x, white.y, 42);
        }

        function pop(id, x, y, show) {
            let e = document.getElementById(id);
            if (show) {
                e.style.opacity = '1';
                e.style.left = constrain(x, 40, width-100)+'px'; 
                e.style.top = constrain(y, 40, height-70)+'px';
            } else {
                e.style.opacity = '0';
            }
        }

        function finish() {
            document.getElementById('snd').pause();
            document.getElementById('end-screen').style.display = 'flex';
            document.getElementById('sum-txt').innerText = `you stayed in the flow for ${Math.floor(frames/60)}s.\n\nyou gathered ${pEaten} moments of sweetness\nand ${dEaten} moments of clarity.\n\nyou have reclaimed your focus.\nyreturn to life.`;
        }

        function windowResized() { resizeCanvas(windowWidth, windowHeight); }
    </script>
</body>
</html>
