<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The In-Between | Choice</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.js"></script>
    <style>
        * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: none; }
        body { margin: 0; padding: 0; background: #050505; overflow: hidden; cursor: crosshair; }
        
        #stats-bar {
            position: absolute; top: 30px; width: 100%;
            display: flex; justify-content: center; gap: 40px;
            color: rgba(255, 255, 255, 0.2);
            font-family: 'Inter', sans-serif; font-weight: 200;
            font-size: 0.8rem; letter-spacing: 2px; pointer-events: none;
        }

        #quit-btn {
            position: absolute; bottom: 30px; right: 30px;
            color: rgba(255, 255, 255, 0.2); font-family: 'Inter', sans-serif;
            font-size: 0.7rem; letter-spacing: 2px; border: 1px solid rgba(255,255,255,0.1);
            padding: 8px 15px; border-radius: 20px; cursor: pointer;
            z-index: 300; transition: all 0.3s;
        }
        #quit-btn:hover { background: rgba(255,255,255,0.05); color: #fff; }

        #end-screen {
            position: fixed; inset: 0; background: #050505;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; text-align: center; color: white; font-family: 'Inter', sans-serif;
        }

        .ios-bubble {
            position: absolute; background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 0.5px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px; border-radius: 20px; color: white;
            font-family: -apple-system, sans-serif; font-size: 13px;
            pointer-events: none; display: none; z-index: 100;
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="stats-bar">
        <span id="flow-count">FLOW: 0s</span>
        <span id="apple-count">APPLES: 0</span>
        <span id="diamond-count">DIAMONDS: 0</span>
    </div>

    <div id="quit-btn" onclick="endSession()">END SESSION</div>

    <div id="end-screen">
        <h2 style="font-weight: 200; letter-spacing: 5px;">SESSION COMPLETE</h2>
        <p id="summary-text" style="color: #666; font-weight: 200; line-height: 1.6; max-width: 300px; margin-bottom: 30px;"></p>
        <button onclick="location.reload()" style="background:none; border: 1px solid #333; color:#fff; padding: 10px 20px; border-radius: 20px; cursor:pointer;">RETURN</button>
    </div>

    <div id="gold-msg" class="ios-bubble">follow me</div>
    <div id="red-msg" class="ios-bubble">thankyou</div>

    <script>
        let gold, white, red;
        let items = []; // Both apples and diamonds
        let angle = 0;
        let flowFrames = 0, applesEaten = 0, diamondsEaten = 0;
        let started = false;
        const OFFSET_Y = -120;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            gold = createVector(width/2, height*0.3);
            white = createVector(width/2, height*0.5);
            red = createVector(width/2, height*0.7);
        }

        function draw() {
            background(5, 5, 5, 80);

            angle += 0.005;
            gold.x = width/2 + cos(angle * 0.7) * (width * 0.3);
            gold.y = height/2 + sin(angle * 0.9) * (height * 0.25);

            if (mouseIsPressed || touches.length > 0) {
                started = true;
                let targetWhite = createVector(mouseX, mouseY + OFFSET_Y);
                white.lerp(targetWhite, 0.15);
            }

            red.lerp(white, 0.04);

            // Spawn Logic
            if (started && frameCount % 120 === 0) {
                let type = random() > 0.4 ? 'apple' : 'diamond';
                items.push({
                    pos: createVector(random(50, width-50), random(100, height-100)),
                    type: type,
                    life: 400
                });
            }

            // Consumption
            for (let i = items.length - 1; i >= 0; i--) {
                let d = dist(white.x, white.y, items[i].pos.x, items[i].pos.y);
                if (d < 35) {
                    if (items[i].type === 'apple') applesEaten++;
                    else diamondsEaten++;
                    items.splice(i, 1);
                    if ("vibrate" in navigator) navigator.vibrate(10);
                } else {
                    items[i].life--;
                    if (items[i].life <= 0) items.splice(i, 1);
                }
            }

            let distance = dist(white.x, white.y, gold.x, gold.y);
            let totalFlow = Math.floor(flowFrames / 60);
            
            updateUI(distance, totalFlow);
            drawVisuals(distance);
        }

        function updateUI(d, flow) {
            document.getElementById('flow-count').innerText = `FLOW: ${flow}s`;
            document.getElementById('apple-count').innerText = `APPLES: ${applesEaten}`;
            document.getElementById('diamond-count').innerText = `DIAMONDS: ${diamondsEaten}`;

            if (d > 220) {
                red.x += random(-3, 3); red.y += random(-3, 3); // Shaking
                document.getElementById('gold-msg').style.display = 'block';
                document.getElementById('gold-msg').style.left = (gold.x + 20) + 'px';
                document.getElementById('gold-msg').style.top = (gold.y - 50) + 'px';
            } else {
                if (started) flowFrames++;
                document.getElementById('gold-msg').style.display = 'none';
            }

            document.getElementById('red-msg').style.display = (flow >= 10 && d <= 220) ? 'block' : 'none';
            if (document.getElementById('red-msg').style.display === 'block') {
                document.getElementById('red-msg').style.left = (red.x + 20) + 'px';
                document.getElementById('red-msg').style.top = (red.y + 20) + 'px';
            }
        }

        function drawVisuals(d) {
            // Draw Items
            items.forEach(item => {
                if (item.type === 'apple') {
                    fill(150, 255, 100, 180); ellipse(item.pos.x, item.pos.y, 10, 10); // Apple
                } else {
                    push(); translate(item.pos.x, item.pos.y); rotate(QUARTER_PI);
                    fill(100, 200, 255, 180); rect(-6, -6, 12, 12); pop(); // Diamond
                }
            });

            // Lines
            strokeWeight(1);
            stroke(d > 220 ? color(255, 0, 0, 100) : color(255, 255, 255, 10));
            line(white.x, white.y, red.x, red.y);
            stroke(255, 255, 255, 10);
            line(gold.x, gold.y, white.x, white.y);

            // Dots
            noStroke();
            fill(212, 175, 55); ellipse(gold.x, gold.y, 28, 28);
            fill(200, 50, 50); ellipse(red.x, red.y, 22, 22);
            fill(255); ellipse(white.x, white.y, 16, 16);
        }

        function endSession() {
            let flow = Math.floor(flowFrames / 60);
            document.getElementById('end-screen').style.display = 'flex';
            document.getElementById('summary-text').innerText = 
                `You maintained ${flow}s of pure focus.\nCollected ${applesEaten} apples for the journey.\nAnd successfully handled ${diamondsEaten} diamonds.\n\nYour mind is now ready.`;
        }
    </script>
</body>
</html>
